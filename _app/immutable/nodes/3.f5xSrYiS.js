import{s as Ne,n as ee,d as g,A as je,b as Ee,i as E,e as R,B as te,x as h,f as B,h as D,j as X,k as x,p as A,l as U,t as q,m as K,r as Z,z as Te,y as le,C as j,D as T,E as Me}from"../chunks/CG7iAfK8.js";import{S as Ce,i as Re,t as Y,a as F,c as Pe,g as Ge,d as Ae,m as ze,e as Fe,b as Be}from"../chunks/iLweqiqo.js";import{b as Ue,p as We,a as re,z as Ye,s as ne,i as se,e as W,u as He,d as Je,m as oe,c as ae,l as ie}from"../chunks/BOaA3tQ3.js";function ce(s){let t,l=s[0].length+"",e,r;return{c(){t=U("p"),e=q(l),r=q(" cells generated. Ready to export!"),this.h()},l(o){t=B(o,"P",{class:!0});var n=D(t);e=X(n,l),r=X(n," cells generated. Ready to export!"),n.forEach(g),this.h()},h(){h(t,"class","svelte-blfr7n")},m(o,n){E(o,t,n),R(t,e),R(t,r)},p(o,n){n&1&&l!==(l=o[0].length+"")&&Ee(e,l)},d(o){o&&g(t)}}}function Ve(s){let t,l,e=s[1]?"Processing...":"Generate Grid",r,o,n,i,u,f,_,b,m,c=s[0].length>0&&ce(s);return{c(){t=U("div"),l=U("button"),r=q(e),o=K(),n=U("button"),i=q("Export GeoJSON"),f=K(),c&&c.c(),_=A(),this.h()},l(a){t=B(a,"DIV",{class:!0});var d=D(t);l=B(d,"BUTTON",{class:!0});var M=D(l);r=X(M,e),M.forEach(g),o=x(d),n=B(d,"BUTTON",{class:!0});var I=D(n);i=X(I,"Export GeoJSON"),I.forEach(g),d.forEach(g),f=x(a),c&&c.l(a),_=A(),this.h()},h(){l.disabled=s[1],h(l,"class","svelte-blfr7n"),n.disabled=u=!s[0].length||s[1],h(n,"class","svelte-blfr7n"),h(t,"class","controls svelte-blfr7n")},m(a,d){E(a,t,d),R(t,l),R(l,r),R(t,o),R(t,n),R(n,i),E(a,f,d),c&&c.m(a,d),E(a,_,d),b||(m=[te(l,"click",s[2]),te(n,"click",s[3])],b=!0)},p(a,[d]){d&2&&e!==(e=a[1]?"Processing...":"Generate Grid")&&Ee(r,e),d&2&&(l.disabled=a[1]),d&3&&u!==(u=!a[0].length||a[1])&&(n.disabled=u),a[0].length>0?c?c.p(a,d):(c=ce(a),c.c(),c.m(_.parentNode,_)):c&&(c.d(1),c=null)},i:ee,o:ee,d(a){a&&(g(t),g(f),g(_)),c&&c.d(a),b=!1,je(m)}}}function Xe(s,t,l){let{xScale:e}=t,{yScale:r}=t,{width:o=window.innerWidth}=t,{height:n=window.innerHeight}=t,{gridSize:i=4}=t,{streetBufferDistance:u=10}=t,f=null,_=[],b=!1;Z(async()=>{try{f=await(await fetch("/map.geojson")).json(),console.log("GeoJSON loaded! Ready to process.")}catch(a){console.error("Error loading map.geojson",a)}});async function m(){var H,z,J;if(!f||!e||!r){console.warn("Missing xScale/yScale/geoData");return}l(0,_=[]),l(1,b=!0);const a=Math.ceil(o/i),d=Math.ceil(n/i),M=f.features.filter(S=>S.geometry.type==="Polygon"||S.geometry.type==="MultiPolygon"),L=f.features.filter(S=>{var O;return(S.geometry.type==="LineString"||S.geometry.type==="MultiLineString")&&((O=S.properties)==null?void 0:O.highway)}).map((S,O)=>{try{const k=Ue(S,u,{units:"meters"});return k.id=S.id||O,k}catch(k){return console.error("Buffer error",k),null}}).filter(S=>S);console.log("Starting grid generation...");for(let S=0;S<a;S++)for(let O=0;O<d;O++){const k=S*i,y=O*i,p=e.invert(k+i/2),C=r.invert(y+i/2),G=We([p,C]);let v=null;for(let w of L)if(re(G,w)){v="street";break}if(!v){for(let w of M)if(re(G,w)){((H=w.properties)==null?void 0:H.leisure)==="park"?v="park":((z=w.properties)==null?void 0:z.natural)==="water"||(J=w.properties)!=null&&J.waterway?v="water":v="other";break}}if(v){const w=e.invert(k),P=e.invert(k+i),N=r.invert(y+i),V=r.invert(y),Q={type:"Feature",geometry:{type:"Polygon",coordinates:[[[w,N],[w,V],[P,V],[P,N],[w,N]]]},properties:{type:v}};_.push(Q)}}l(1,b=!1),console.log(`Grid generated! ${_.length} cells.`)}function c(){if(!_.length){console.warn("No grid cells to export!");return}const d=JSON.stringify({type:"FeatureCollection",features:_}),M=new Blob([d],{type:"application/json"}),I=URL.createObjectURL(M),L=document.createElement("a");L.href=I,L.download=`pixelated_grid_${i}grid_${u}buffer.geojson`,document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(I),console.log("Export complete!")}return s.$$set=a=>{"xScale"in a&&l(4,e=a.xScale),"yScale"in a&&l(5,r=a.yScale),"width"in a&&l(6,o=a.width),"height"in a&&l(7,n=a.height),"gridSize"in a&&l(8,i=a.gridSize),"streetBufferDistance"in a&&l(9,u=a.streetBufferDistance)},[_,b,m,c,e,r,o,n,i,u]}class qe extends Ce{constructor(t){super(),Re(this,t,Xe,Ve,Ne,{xScale:4,yScale:5,width:6,height:7,gridSize:8,streetBufferDistance:9})}}function fe(s,t,l){const e=s.slice();return e[25]=t[l],e[27]=l,e}function ue(s,t,l){const e=s.slice();return e[25]=t[l],e}function he(s,t,l){const e=s.slice();return e[30]=t[l],e[27]=l,e}function de(s){let t,l,e,r=s[0].length>0&&ge(s);return{c(){t=U("div"),l=U("div"),r&&r.c(),this.h()},l(o){t=B(o,"DIV",{class:!0});var n=D(t);l=B(n,"DIV",{class:!0});var i=D(l);r&&r.l(i),i.forEach(g),n.forEach(g),this.h()},h(){h(l,"class","main svelte-164r9yn"),h(t,"class","container svelte-164r9yn")},m(o,n){E(o,t,n),R(t,l),r&&r.m(l,null),e=!0},p(o,n){o[0].length>0?r?(r.p(o,n),n[0]&1&&F(r,1)):(r=ge(o),r.c(),F(r,1),r.m(l,null)):r&&(Ge(),Y(r,1,1,()=>{r=null}),Pe())},i(o){e||(F(r),e=!0)},o(o){Y(r),e=!1},d(o){o&&g(t),r&&r.d()}}}function ge(s){let t,l,e,r,o=[],n=new Map,i,u,f;t=new qe({props:{transform:s[7],xScale:s[5],yScale:s[6]}});let _=W(s[3]);const b=c=>c[25].id;for(let c=0;c<_.length;c+=1){let a=ue(s,_,c),d=b(a);n.set(d,o[c]=me(d,a))}let m=s[4].length>1&&pe(s);return{c(){Be(t.$$.fragment),l=K(),e=T("svg"),r=T("g");for(let c=0;c<o.length;c+=1)o[c].c();i=A(),m&&m.c(),this.h()},l(c){Fe(t.$$.fragment,c),l=x(c),e=j(c,"svg",{style:!0,class:!0});var a=D(e);r=j(a,"g",{transform:!0});var d=D(r);for(let M=0;M<o.length;M+=1)o[M].l(d);i=A(),m&&m.l(d),d.forEach(g),a.forEach(g),this.h()},h(){h(r,"transform",u="translate("+s[7].x+", "+s[7].y+") scale("+s[7].k+")"),le(e,"width","100%"),le(e,"height","100vh"),h(e,"class","svelte-164r9yn")},m(c,a){ze(t,c,a),E(c,l,a),E(c,e,a),R(e,r);for(let d=0;d<o.length;d+=1)o[d]&&o[d].m(r,null);R(r,i),m&&m.m(r,null),s[12](e),f=!0},p(c,a){const d={};a[0]&128&&(d.transform=c[7]),a[0]&32&&(d.xScale=c[5]),a[0]&64&&(d.yScale=c[6]),t.$set(d),a[0]&776&&(_=W(c[3]),o=He(o,a,b,1,c,_,n,r,Je,me,i,ue)),c[4].length>1?m?m.p(c,a):(m=pe(c),m.c(),m.m(r,null)):m&&(m.d(1),m=null),(!f||a[0]&128&&u!==(u="translate("+c[7].x+", "+c[7].y+") scale("+c[7].k+")"))&&h(r,"transform",u)},i(c){f||(F(t.$$.fragment,c),f=!0)},o(c){Y(t.$$.fragment,c),f=!1},d(c){c&&(g(l),g(e)),Ae(t,c);for(let a=0;a<o.length;a+=1)o[a].d();m&&m.d(),s[12](null)}}}function Qe(s){let t,l;return{c(){t=T("circle"),this.h()},l(e){t=j(e,"circle",{r:!0,fill:!0,stroke:!0,"stroke-width":!0,class:!0}),D(t).forEach(g),this.h()},h(){h(t,"r",s[8]),h(t,"fill","none"),h(t,"stroke",l=s[25].color),h(t,"stroke-width","0.1"),h(t,"class","svelte-164r9yn")},m(e,r){E(e,t,r)},p(e,r){r[0]&8&&l!==(l=e[25].color)&&h(t,"stroke",l)},d(e){e&&g(t)}}}function xe(s){let t,l=W(Array(s[25].numRings)),e=[];for(let r=0;r<l.length;r+=1)e[r]=_e(he(s,l,r));return{c(){for(let r=0;r<e.length;r+=1)e[r].c();t=A()},l(r){for(let o=0;o<e.length;o+=1)e[o].l(r);t=A()},m(r,o){for(let n=0;n<e.length;n+=1)e[n]&&e[n].m(r,o);E(r,t,o)},p(r,o){if(o[0]&776){l=W(Array(r[25].numRings));let n;for(n=0;n<l.length;n+=1){const i=he(r,l,n);e[n]?e[n].p(i,o):(e[n]=_e(i),e[n].c(),e[n].m(t.parentNode,t))}for(;n<e.length;n+=1)e[n].d(1);e.length=l.length}},d(r){r&&g(t),Me(e,r)}}}function _e(s){let t,l;return{c(){t=T("circle"),this.h()},l(e){t=j(e,"circle",{r:!0,fill:!0,stroke:!0,"stroke-width":!0,class:!0}),D(t).forEach(g),this.h()},h(){h(t,"r",s[8]+s[27]*s[9]),h(t,"fill","none"),h(t,"stroke",l=s[25].color),h(t,"stroke-width","0.1"),h(t,"class","svelte-164r9yn")},m(e,r){E(e,t,r)},p(e,r){r[0]&8&&l!==(l=e[25].color)&&h(t,"stroke",l)},d(e){e&&g(t)}}}function me(s,t){let l,e;function r(i,u){return i[25].numRings>0?xe:Qe}let o=r(t),n=o(t);return{key:s,first:null,c(){l=T("g"),n.c(),this.h()},l(i){l=j(i,"g",{class:!0,transform:!0});var u=D(l);n.l(u),u.forEach(g),this.h()},h(){h(l,"class","node svelte-164r9yn"),h(l,"transform",e="translate("+t[25].x+", "+t[25].y+")"),this.first=l},m(i,u){E(i,l,u),n.m(l,null)},p(i,u){t=i,o===(o=r(t))&&n?n.p(t,u):(n.d(1),n=o(t),n&&(n.c(),n.m(l,null))),u[0]&8&&e!==(e="translate("+t[25].x+", "+t[25].y+")")&&h(l,"transform",e)},d(i){i&&g(l),n.d()}}}function pe(s){let t,l,e,r,o=W(s[4].slice(0,s[4].length-1)),n=[];for(let i=0;i<o.length;i+=1)n[i]=ke(fe(s,o,i));return{c(){t=T("g"),l=T("defs"),e=T("marker"),r=T("polygon");for(let i=0;i<n.length;i+=1)n[i].c();this.h()},l(i){t=j(i,"g",{class:!0});var u=D(t);l=j(u,"defs",{});var f=D(l);e=j(f,"marker",{id:!0,markerWidth:!0,markerHeight:!0,refX:!0,refY:!0,orient:!0});var _=D(e);r=j(_,"polygon",{points:!0,fill:!0}),D(r).forEach(g),_.forEach(g),f.forEach(g);for(let b=0;b<n.length;b+=1)n[b].l(u);u.forEach(g),this.h()},h(){h(r,"points","0 0, 6 2, 0 4"),h(r,"fill","blue"),h(e,"id","arrowhead"),h(e,"markerWidth","6"),h(e,"markerHeight","4"),h(e,"refX","3"),h(e,"refY","2"),h(e,"orient","auto"),h(t,"class","curator-path svelte-164r9yn")},m(i,u){E(i,t,u),R(t,l),R(l,e),R(e,r);for(let f=0;f<n.length;f+=1)n[f]&&n[f].m(t,null)},p(i,u){if(u[0]&16){o=W(i[4].slice(0,i[4].length-1));let f;for(f=0;f<o.length;f+=1){const _=fe(i,o,f);n[f]?n[f].p(_,u):(n[f]=ke(_),n[f].c(),n[f].m(t,null))}for(;f<n.length;f+=1)n[f].d(1);n.length=o.length}},d(i){i&&g(t),Me(n,i)}}}function ye(s){let t,l;return{c(){t=T("path"),this.h()},l(e){t=j(e,"path",{d:!0,fill:!0,stroke:!0,"stroke-width":!0,"marker-end":!0,class:!0}),D(t).forEach(g),this.h()},h(){h(t,"d",l=De(s[25],s[4][s[27]+1])),h(t,"fill","none"),h(t,"stroke","blue"),h(t,"stroke-width",".5"),h(t,"marker-end","url(#arrowhead)"),h(t,"class","svelte-164r9yn")},m(e,r){E(e,t,r)},p(e,r){r[0]&16&&l!==(l=De(e[25],e[4][e[27]+1]))&&h(t,"d",l)},d(e){e&&g(t)}}}function ke(s){let t,l=s[4][s[27]+1]&&ye(s);return{c(){l&&l.c(),t=A()},l(e){l&&l.l(e),t=A()},m(e,r){l&&l.m(e,r),E(e,t,r)},p(e,r){e[4][e[27]+1]?l?l.p(e,r):(l=ye(e),l.c(),l.m(t.parentNode,t)):l&&(l.d(1),l=null)},d(e){e&&g(t),l&&l.d(e)}}}function Ke(s){let t,l,e=s[0].length>0&&s[1].length>0&&de(s);return{c(){e&&e.c(),t=A()},l(r){e&&e.l(r),t=A()},m(r,o){e&&e.m(r,o),E(r,t,o),l=!0},p(r,o){r[0].length>0&&r[1].length>0?e?(e.p(r,o),o[0]&3&&F(e,1)):(e=de(r),e.c(),F(e,1),e.m(t.parentNode,t)):e&&(Ge(),Y(e,1,1,()=>{e=null}),Pe())},i(r){l||(F(e),l=!0)},o(r){Y(e),l=!1},d(r){r&&g(t),e&&e.d(r)}}}const be=1,ve=1,we=10,Se=5;function Ze(s){return"DarkSeaGreen"}function De(s,t,l=20){const e=t.x-s.x,r=t.y-s.y,o=(s.x+t.x)/2,n=(s.y+t.y)/2,i=Math.sqrt(e*e+r*r)||1,u=-r/i,f=e/i,_=o+u*l,b=n+f*l;return`M ${s.x} ${s.y} Q ${_} ${b} ${t.x} ${t.y}`}function $e(s,t,l){let e,r=[],o=[],n=2011,i,u=null;Z(async()=>{const k=await fetch("data/ArnArbPlantsGEO.json");l(0,r=await k.json()),Math.min(...r.map(p=>parseInt(p.ACC_YR))),i=Math.max(...r.map(p=>parseInt(p.ACC_YR))),l(10,n=i);const y=await fetch("data/Curator_Plants_Dates.json");l(1,o=await y.json()),o.length>0&&l(11,u=o[0])});let f,_=[],b,m,c=se,a;const d=be+(we-1)*ve,M=Se/2/d,I=be*M,L=ve*M,H=d*M,z=Se;function J(){f.clientWidth,f.clientHeight;const k=r.map(N=>parseFloat(N.LONGITUDE)).filter(N=>!isNaN(N)),y=r.map(N=>parseFloat(N.LATITUDE)).filter(N=>!isNaN(N));let p=oe(k),C=ae(k),G=oe(y),v=ae(y);const w=(C-p)*.2,P=(v-G)*.2;p-=w,C+=w,G-=P,v+=P,l(5,b=ie().domain([p,C]).range([0,f.clientWidth])),l(6,m=ie().domain([G,v]).range([f.clientHeight,0]))}function S(){return!r||!f||n===void 0?[]:(J(),r.map((y,p)=>{const C=parseFloat(y.LONGITUDE),G=parseFloat(y.LATITUDE),v=parseInt(y.ACC_YR),w=parseInt(y.last_date);if(isNaN(C)||isNaN(G)||isNaN(v)||isNaN(w))return null;let P=0;n>=v&&(P=Math.floor((n-v)/10),P=Math.min(P,we));let N=P>0?I+(P-1)*L:I;N=Math.min(N,H);const V=b(C),$=m(G),Q=Math.floor(V/z),Ie=Math.floor($/z),Le=Q*z+z/2,Oe=Ie*z+z/2;return{id:y.PLANTID?y.PLANTID:p,x:Le,y:Oe,accYear:v,lastDate:w,numRings:P,outerRadius:N,color:Ze()}}).filter(Boolean))}Z(()=>{a=Ye().scaleExtent([2,14]).on("zoom",w=>{l(7,c=w.transform)}),ne(f).call(a);const k=f.clientWidth,y=f.clientHeight,p=2,C=k/2-p*(k/1.8),G=y/2-p*(y/2.5),v=se.translate(C,G).scale(p);ne(f).call(a.transform,v),l(7,c=v)});function O(k){Te[k?"unshift":"push"](()=>{f=k,l(2,f)})}return s.$$.update=()=>{if(s.$$.dirty[0]&2&&console.log(o),s.$$.dirty[0]&1029&&r&&f&&n!==void 0&&l(3,_=S()),s.$$.dirty[0]&2072&&u&&u.PlantDates){const y=[...u.PlantDates].sort((p,C)=>p.Date-C.Date).map(p=>String(p.PlantID).toLowerCase());l(4,e=_.filter(p=>y.includes(String(p.id).toLowerCase()))),e.sort((p,C)=>y.indexOf(String(p.id).toLowerCase())-y.indexOf(String(C.id).toLowerCase()))}},l(4,e=[]),[r,o,f,_,e,b,m,c,I,L,n,u,O]}class rt extends Ce{constructor(t){super(),Re(this,t,$e,Ke,Ne,{},null,[-1,-1])}}export{rt as component};
